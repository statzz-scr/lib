-- Library Setup
local function CreateLib()
	local ScreenGui = Instance.new("ScreenGui")
	local Main = Instance.new("Frame")
	local UICorner = Instance.new("UICorner")
	local UIGradient = Instance.new("UIGradient")
	local Title = Instance.new("TextLabel")
	local UICorner_2 = Instance.new("UICorner")
	local TabsButton = Instance.new("TextButton")
	local UICorner_3 = Instance.new("UICorner")
	local Close = Instance.new("TextButton")
	local UICorner_4 = Instance.new("UICorner")
	local CloseText = Instance.new("TextLabel")
	local Drag = Instance.new("Frame")
	local Tabs = Instance.new("Frame")
	local UICorner_6 = Instance.new("UICorner")
	local UIGradient_2 = Instance.new("UIGradient")
	local TopBar = Instance.new("Frame")
	local UICorner_12 = Instance.new("UICorner")
	local Open = Instance.new("TextButton")
	local UICorner_13 = Instance.new("UICorner")
	local UIGradient_3 = Instance.new("UIGradient")
	local Title_2 = Instance.new("TextLabel")
	local Fps = Instance.new("TextLabel")
	local Ping = Instance.new("TextLabel")
	local TabTitle = Instance.new("TextLabel")
	local UICorner_TabTitle = Instance.new("UICorner")
	local Container = Instance.new("ScrollingFrame")

	local PermanentMarker = Font.new("rbxasset://fonts/families/PermanentMarker.json")
	local TweenService = game:GetService("TweenService")
	local RunService = game:GetService("RunService")

	ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
	ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	ScreenGui.ResetOnSpawn = false

	Main.Name = "Main"
	Main.Parent = ScreenGui
	Main.BackgroundColor3 = Color3.fromRGB(42, 42, 42)
	Main.Position = UDim2.new(0.5, -221, 0.5, -109)
	Main.Size = UDim2.new(0, 442, 0, 218)
	UICorner.CornerRadius = UDim.new(0, 20)
	UICorner.Parent = Main
	UIGradient.Color = ColorSequence.new{ColorSequenceKeypoint.new(0, Color3.fromRGB(168, 0, 3)), ColorSequenceKeypoint.new(1, Color3.fromRGB(168, 0, 3))}
	UIGradient.Parent = Main

	Title.Parent = Main
	Title.BackgroundTransparency = 0.8
	Title.Position = UDim2.new(0.224, 0, 0.028, 0)
	Title.Size = UDim2.new(0, 243, 0, 30)
	Title.FontFace = PermanentMarker
	Title.Text = "üò°try1üò° hub"
	Title.TextColor3 = Color3.fromRGB(255, 255, 255)
	Title.TextScaled = true
	UICorner_2.Parent = Title

	TabsButton.Parent = Main
	TabsButton.BackgroundTransparency = 0.8
	TabsButton.Position = UDim2.new(0.018, 0, 0.046, 0)
	TabsButton.Size = UDim2.new(0, 83, 0, 21)
	TabsButton.FontFace = PermanentMarker
	TabsButton.Text = "Tabs"
	TabsButton.TextColor3 = Color3.fromRGB(255, 255, 255)
	TabsButton.TextScaled = true
	UICorner_3.Parent = TabsButton

	Close.Parent = Main
	Close.BackgroundTransparency = 0.8
	Close.Position = UDim2.new(0.79, 0, 0.046, 0)
	Close.Size = UDim2.new(0, 83, 0, 21)
	Close.FontFace = PermanentMarker
	Close.Text = "X"
	Close.TextColor3 = Color3.fromRGB(255, 255, 255)
	Close.TextScaled = true
	UICorner_4.Parent = Close

	CloseText.Parent = Close
	CloseText.BackgroundTransparency = 1
	CloseText.Size = UDim2.new(0, 406, 0, 193)
	CloseText.FontFace = PermanentMarker
	CloseText.Text = "‚úåÔ∏è"
	CloseText.TextTransparency = 1
	CloseText.TextScaled = true

	Drag.Name = "Drag"
	Drag.Parent = Main
	Drag.BackgroundTransparency = 1
	Drag.Position = UDim2.new(0.224, 0, 0.028, 0)
	Drag.Size = UDim2.new(0, 242, 0, 30)

	Tabs.Name = "Tabs"
	Tabs.Parent = Main
	Tabs.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	Tabs.BackgroundTransparency = 1
	Tabs.Position = UDim2.new(-0.246, 0, 0, 0)
	Tabs.Size = UDim2.new(0, 100, 0, 218)
	Tabs.Visible = false
	UICorner_6.CornerRadius = UDim.new(0, 20)
	UICorner_6.Parent = Tabs
	UIGradient_2.Color = ColorSequence.new(Color3.fromRGB(255, 0, 0))
	UIGradient_2.Parent = Tabs
	
	Instance.new("UIListLayout", Tabs).HorizontalAlignment = Enum.HorizontalAlignment.Center
	Instance.new("UIPadding", Tabs).PaddingTop = UDim.new(0, 10)

	TabTitle.Parent = Main
	TabTitle.BackgroundTransparency = 0.85
	TabTitle.Position = UDim2.new(0.274, 0, 0.197, 0)
	TabTitle.Size = UDim2.new(0, 200, 0, 29)
	TabTitle.FontFace = PermanentMarker
	TabTitle.Text = "Select Tab"
	TabTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
	TabTitle.TextSize = 14
	UICorner_TabTitle.Parent = TabTitle

	-- Container Setup with Scroll Arrangement
	Container.Name = "Container"
	Container.Parent = Main
	Container.BackgroundTransparency = 1
	Container.Position = UDim2.new(0, 0, 0.372, 0)
	Container.Size = UDim2.new(1, 0, 0.628, 0)
	Container.ScrollBarThickness = 2
	Container.CanvasSize = UDim2.new(0, 0, 0, 0)
	Container.AutomaticCanvasSize = Enum.AutomaticSize.Y -- Arranged by how much buttons

	TopBar.Parent = ScreenGui
	TopBar.AnchorPoint = Vector2.new(0.5, 0)
	TopBar.BackgroundColor3 = Color3.fromRGB(33, 33, 33)
	TopBar.Position = UDim2.new(0.5, 0, 0, 5)
	TopBar.Size = UDim2.new(0, 312, 0, 55)
	UICorner_12.CornerRadius = UDim.new(0, 20)
	UICorner_12.Parent = TopBar
	UIGradient_3.Color = ColorSequence.new(Color3.fromRGB(255, 0, 0))
	UIGradient_3.Parent = TopBar

	Open.Parent = TopBar
	Open.BackgroundTransparency = 0.75
	Open.Position = UDim2.new(0.804, 0, 0.1, 0)
	Open.Size = UDim2.new(0, 52, 0, 40)
	Open.FontFace = PermanentMarker
	Open.Text = "open"
	Open.TextColor3 = Color3.fromRGB(255, 255, 255)
	UICorner_13.CornerRadius = UDim.new(0, 20)
	UICorner_13.Parent = Open

	Title_2.Parent = TopBar
	Title_2.BackgroundTransparency = 1
	Title_2.Position = UDim2.new(0.083, 0, 0.05, 0)
	Title_2.Size = UDim2.new(0, 200, 0, 24)
	Title_2.FontFace = PermanentMarker
	Title_2.Text = "üò°try1üò° hub"
	Title_2.TextColor3 = Color3.fromRGB(255, 255, 255)
	Title_2.TextScaled = true

	Fps.Parent = TopBar
	Fps.BackgroundTransparency = 1
	Fps.Position = UDim2.new(0.083, 0, 0.55, 0)
	Fps.Size = UDim2.new(0, 91, 0, 20)
	Fps.FontFace = PermanentMarker
	Fps.Text = "FPS: 0"
	Fps.TextColor3 = Color3.fromRGB(255, 255, 255)
	Fps.TextSize = 18

	Ping.Parent = TopBar
	Ping.BackgroundTransparency = 1
	Ping.Position = UDim2.new(0.404, 0, 0.55, 0)
	Ping.Size = UDim2.new(0, 100, 0, 20)
	Ping.FontFace = PermanentMarker
	Ping.Text = "Ping: 0ms"
	Ping.TextColor3 = Color3.fromRGB(255, 255, 255)
	Ping.TextSize = 18

	-- SMOOTH DRAGGING
	local function makeDraggable(frame, handle)
		local dragInput, dragStart, startPos
		local lerpSpeed = 0.25

		handle.InputBegan:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				dragStart = input.Position
				startPos = frame.Position
				input.Changed:Connect(function()
					if input.UserInputState == Enum.UserInputState.End then
						dragStart = nil
					end
				end)
			end
		end)

		handle.InputChanged:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseMovement then
				dragInput = input
			end
		end)

		RunService.RenderStepped:Connect(function()
			if dragStart and dragInput then
				local delta = dragInput.Position - dragStart
				local targetPos = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
				frame.Position = frame.Position:Lerp(targetPos, lerpSpeed)
			end
		end)
	end
	makeDraggable(Main, Drag)

	-- Logic for Tabs Fade
	local originalTransparencies = {}
	local function saveOriginals()
		for _, obj in ipairs(Main:GetDescendants()) do
			if obj:IsA("GuiObject") then
				originalTransparencies[obj] = {
					bg = obj.BackgroundTransparency,
					text = (obj:IsA("TextLabel") or obj:IsA("TextButton")) and obj.TextTransparency or nil
				}
			end
		end
		originalTransparencies[Main] = {bg = Main.BackgroundTransparency}
	end
	saveOriginals()

	local function setFade(target)
		local tweenInfo = TweenInfo.new(0.4)
		for obj, values in pairs(originalTransparencies) do
			if not obj:IsDescendantOf(game) then continue end
			local targetBg = (target == 1) and 1 or values.bg
			TweenService:Create(obj, tweenInfo, {BackgroundTransparency = targetBg}):Play()
			if values.text then
				local targetText = (target == 1) and 1 or values.text
				TweenService:Create(obj, tweenInfo, {TextTransparency = targetText}):Play()
			end
		end
	end

	local tabsVisible = false
	TabsButton.MouseButton1Click:Connect(function()
		tabsVisible = not tabsVisible
		if tabsVisible then
			Tabs.Visible = true
			TweenService:Create(Tabs, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {BackgroundTransparency = 0}):Play()
		else
			local tween = TweenService:Create(Tabs, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {BackgroundTransparency = 1})
			tween:Play()
			tween.Completed:Wait()
			if not tabsVisible then Tabs.Visible = false end
		end
	end)

	Close.MouseButton1Click:Connect(function()
		TweenService:Create(CloseText, TweenInfo.new(0.35), {TextTransparency = 0}):Play()
		task.wait(0.4); setFade(1); task.wait(0.5); ScreenGui:Destroy()
	end)

	local mainVisible = true
	Open.MouseButton1Click:Connect(function()
		mainVisible = not mainVisible
		if mainVisible then Main.Visible = true; setFade(0) else setFade(1); task.wait(0.4); if not mainVisible then Main.Visible = false end end
	end)

	-- Stats Update
	RunService.RenderStepped:Connect(function(dt)
		Fps.Text = "FPS: "..math.floor(1/dt)
		Ping.Text = "Ping: "..math.floor(game.Players.LocalPlayer:GetNetworkPing()*1000).."ms"
	end)

	-- LIBRARY FUNCTIONS
	local Library = {}
	local firstTab = nil
	
	function Library:MakeTab(name)
		local TabButton = Instance.new("TextButton")
		local TabCorner = Instance.new("UICorner")
		local TabContent = Instance.new("Frame")
		local TabList = Instance.new("UIListLayout")

		TabButton.Parent = Tabs
		TabButton.Size = UDim2.new(0, 88, 0, 25)
		TabButton.BackgroundTransparency = 0.85
		TabButton.FontFace = PermanentMarker
		TabButton.Text = name
		TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
		TabCorner.Parent = TabButton
		originalTransparencies[TabButton] = {bg = 0.85, text = 0}

		TabContent.Name = name.."_Content"
		TabContent.Parent = Container
		TabContent.BackgroundTransparency = 1
		TabContent.Size = UDim2.new(1, 0, 0, 0)
		TabContent.AutomaticSize = Enum.AutomaticSize.Y -- Arranged by how much buttons
		TabContent.Visible = false

		TabList.Parent = TabContent
		TabList.HorizontalAlignment = Enum.HorizontalAlignment.Center
		TabList.Padding = UDim.new(0, 10)

		local function select()
			for _, v in pairs(Container:GetChildren()) do if v:IsA("Frame") then v.Visible = false end end
			TabContent.Visible = true
			TabTitle.Text = name
		end
		
		TabButton.MouseButton1Click:Connect(select)
		if not firstTab then firstTab = select end

		local TabFunctions = {}
		function TabFunctions:MakeButton(text, callback)
			local BtnFrame = Instance.new("Frame")
			local BtnLabel = Instance.new("TextLabel")
			local RealBtn = Instance.new("TextButton")
			local Line = Instance.new("Frame")

			BtnFrame.Parent = TabContent
			BtnFrame.BackgroundTransparency = 1
			BtnFrame.Size = UDim2.new(0, 442, 0, 35) -- BUTTONS SMALLER (Original Size)

			BtnLabel.Parent = BtnFrame
			BtnLabel.Position = UDim2.new(0.1, 0, 0, 0)
			BtnLabel.Size = UDim2.new(0, 200, 0, 25) -- Original Smaller Button Size
			BtnLabel.BackgroundTransparency = 0.8
			BtnLabel.FontFace = PermanentMarker
			BtnLabel.Text = text
			BtnLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
			BtnLabel.TextSize = 25 -- Big Text (from requested change)
			Instance.new("UICorner", BtnLabel)

			RealBtn.Parent = BtnFrame
			RealBtn.Position = UDim2.new(0.68, 0, 0, 0)
			RealBtn.Size = UDim2.new(0, 89, 0, 23) -- Original Smaller Button Size
			RealBtn.BackgroundTransparency = 0.85
			RealBtn.FontFace = PermanentMarker
			RealBtn.Text = "Run"
			RealBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
			RealBtn.TextSize = 22 -- Big Text (from requested change)
			Instance.new("UICorner", RealBtn)

			Line.Parent = BtnFrame
			Line.Position = UDim2.new(0.04, 0, 0.95, 0)
			Line.Size = UDim2.new(0, 397, 0, 2)
			Line.BackgroundTransparency = 0.6
			Instance.new("UICorner", Line)
			
			originalTransparencies[BtnLabel] = {bg = 0.8, text = 0}
			originalTransparencies[RealBtn] = {bg = 0.85, text = 0}
			originalTransparencies[Line] = {bg = 0.6}

			RealBtn.MouseButton1Click:Connect(function() pcall(callback) end)
		end
		
		task.spawn(function() if firstTab then firstTab() end end)
		return TabFunctions
	end

	return Library
end

-- Best Pet ESP Logic (Background)
getgenv().BestPetESP = getgenv().BestPetESP or {active = false, loop = nil, currentESP = nil}

local function parseValue(text)
    text = tostring(text or ""):gsub("%s", "")
    local num, suffix = text:match("([%d%.]+)([KkMmBbTt]?)")
    if not num then return 0 end
    num = tonumber(num) or 0
    local mults = {K=1e3, M=1e6, B=1e9, T=1e12}
    return num * (mults[(suffix or ""):upper()] or 1)
end

local function createBestPetESP(part, displayText, valueText)
    if getgenv().BestPetESP.currentESP then pcall(function() getgenv().BestPetESP.currentESP:Destroy() end) end
    if not part then return end
    local bb = Instance.new("BillboardGui", game:GetService("CoreGui"))
    bb.Size = UDim2.new(0, 200, 0, 50); bb.AlwaysOnTop = true; bb.StudsOffset = Vector3.new(0, 3, 0); bb.Adornee = part
    local n = Instance.new("TextLabel", bb)
    n.Size = UDim2.new(1, 0, 0, 25); n.BackgroundTransparency = 1; n.TextScaled = true; n.FontFace = Font.new("rbxasset://fonts/families/PermanentMarker.json")
    n.Text = displayText; n.TextColor3 = Color3.new(1, 1, 0)
    local v = Instance.new("TextLabel", bb)
    v.Size = UDim2.new(1, 0, 0, 25); v.Position = UDim2.new(0, 0, 0, 25); v.BackgroundTransparency = 1; v.TextScaled = true
    v.FontFace = Font.new("rbxasset://fonts/families/PermanentMarker.json")
    v.Text = valueText; v.TextColor3 = Color3.new(0, 1, 0.4)
    getgenv().BestPetESP.currentESP = bb
end
